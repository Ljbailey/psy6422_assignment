---
output: html_document
runtime: shiny
---
# Do Some Cultures Neglect Social Determinants of Mental Health and Well-Being? A Visualisation of Countries Cultural Orientation, Well-Being Outcomes and Wealth.

## Background and Research Question
The onset of the COVID-19 epidemic has challenged countries to work together and take preventative measures to avoid deaths such as social distancing etc. Surprisingly, wealthier countries that have more economic and health resources have higher rates of reported COVID-19 cases and related deaths. More COVID-19 cases and deaths in wealthier countries may therefore stem from people not upholding their social responsibility to comply to government and world health organisations COVID-19 guidelines. Could be individualism. 
This begs the question to whether individualistic cultures have poorer well-being outcomes that are unrelated to wealth but related to social aspects such as the spread of COVID-19, happiness and suicide rates. 


The exploration of cross-cultural norms and values provides insight into how cultural differences influence peoples mental processes and behaviour. Understanding the cultural factors related to benefits in the socio-economic conditions of countries and the inhabitants well-being can inform behavioural change interventions by highlighting favourable attitudes that underpin the countries prosperity.


## Data Origin 
Data was extracted from multiple datasets listed on [Kaggle](https://www.kaggle.com/datasets). An up-to-date [COVID-19 Dataset](https://www.kaggle.com/josephassaker/covid19-global-dataset?select=worldometer_coronavirus_summary_data.csv) using [Woldometer's](https://www.worldometers.info/coronavirus/) statistics provided the  **countries total COVID-19 cases and deaths per 1 million population** data. This dataset was retrieved on 2021/05/11. The countries [cultural dimensions dataset](https://www.kaggle.com/tarukofusuki/hofstedes-6d-model-of-national-culture) stems from [Hofstede's theory](https://www.hofstede-insights.com/country-comparison/) and data from 2015. The **individualism index** that reflects countries relative position on the collectivist - individualist continuum was extracted. Higher scores represent individualist cultural values whereas lower scores represents collectivist cultural values. This continuum refers to the degree of interdependence with the members of society with individualist cultures having a self-image of "I" and collectivist cultures having more concerned about "we". Countries **GDP per Capita ($)** was extracted from a dataset consisting of countries [socioeconomic profiles](https://www.kaggle.com/nishanthsalian/socioeconomic-country-profiles) as of 2017. **Life expectancy** data from 2016 is from the [World Health Organisation dataset](https://www.kaggle.com/mmattson/who-national-life-expectancy). The data from the [2020 World Happiness Report](https://www.kaggle.com/mathurinache/world-happiness-report) was used to extract the **happiness score**. The countries happiness is the average national score on the Cantril Ladder. The [Cantril Ladder](https://news.gallup.com/poll/122453/understanding-gallup-uses-cantril-scale.aspx) consists of people imagining their life in the best and worst way and to rate their present self on a scale from 0-10. **Countries suicide rates of the sexes per 100000 population**  from 2016 was extracted from a [mental health and suicide dataset](https://www.kaggle.com/twinkle0705/mental-health-and-suicide-rates).


## Data Preperation
### Loading In The Data
```{r loading packages, warning = FALSE, echo = FALSE, results= 'hide', message=FALSE}
library(tidyverse)
library(here)
library(countrycode)
library(data.table)
library(plotly)
library(shiny)
library(ggplot2)
library(htmlwidgets)
library(rsconnect)
```

```{r load in data, warning = FALSE}
# Loading in the different datasets

covid <- read.csv(here("covid","worldometer_coronavirus_summary_data.csv"))

dim <- read.csv(here("dimensions", "six_dimenstions.csv"))

ses <- read.csv(here("ses", "soci_econ_country_profiles.csv"))

happy <- read.csv(here("happiness", "world_happiness_report.csv"))

life <- read.csv(here("life", "who_life_exp.csv"))

suicide <- read.csv(here("suicide", "suicide_rate.csv"))

```

### Data Wrangling
#### Modifying Datasets
```{r modifying datasets, warning = FALSE}
# Parse out cultural dimensions data
dim <- dim %>%
         separate(ctr.country.pdi.idv.mas.uai.ltowvs.ivr, 
             c("ctr", "country", "pdi", "idv", "mas", "uai", "lto", "ivr"),
            sep = ";")

dim$idv <- as.numeric(dim$idv)# Changes individualism class to numeric

# Selecting required data from each dataset

covid <- covid %>%
         select(country, total_cases_per_1m_population, total_deaths_per_1m_population)

dim <- dim %>%
         select(country, idv)

ses <- ses %>%
         select(country,GDP.per.capita..current.US..)

happy <- happy %>%
         select(Country.or.region, Score, Overall.rank)

life <- life %>%
         select(country, year, life_expect)

life <- subset(life, year=="2016") # Remove rows not including year 2016

suicide <- suicide %>%
           select(Country, Sex, X2016)

# Re-naming columns of each dataset

colnames(covid)[2] <- "total_cases"
colnames(covid)[3] <- "total_deaths"

colnames(dim)[2] <- "individualism"

colnames(ses)[2] <- "gdp_per_capita"

colnames(happy)[1] <- "country"
colnames(happy)[2] <- "happiness_score"
colnames(happy)[3] <- "rank"

colnames(life)[1] <- "country"
colnames(life)[2] <- "year"
colnames(life)[3] <- "life_expectancy"

colnames(suicide)[1] <- "country"
colnames(suicide)[2] <- "sex"
colnames(suicide)[3] <- "suicide_rate"



```
#### Merging Datasets

```{r merging datasets, warning = FALSE}
#Converting country name to country codes

df.list <- list(ses, dim, covid, happy, life, suicide) # list of dataframes

convert_code <-  function(x) {
      #converts country name to country codes
        countrycode(x, origin = "country.name", destination = "cowc")
}

ses$country <- convert_code(ses$country)

dim$country <- convert_code(dim$country)

covid$country <- convert_code(covid$country)

happy$country <- convert_code(happy$country)

life$country <- convert_code(life$country)

suicide$country <- convert_code(suicide$country)


# Adjoin desired data-frames with country codes

df_covid <- inner_join(covid, dim, "country")

df_covid <- inner_join(df_covid, ses, "country")

df_happiness <- inner_join(happy, dim, "country")

df_happiness <- inner_join(df_happiness, ses, "country")

df_life <- inner_join(life, dim, "country")

df_life <- inner_join(df_life, ses, "country")

df_suicide <- inner_join(suicide, dim, "country")

df_suicide <- inner_join(df_suicide, ses, "country")

df_sui_happ <- inner_join(suicide, dim, "country")

df_sui_happ <- inner_join(df_sui_happ, happy, "country")

df_sui_happ <- inner_join(df_sui_happ, ses, "country")

df_wealth <- inner_join(dim, ses, "country")

df_all <- inner_join(df_sui_happ, covid, "country")

df_all <- inner_join(df_all, life, "country")

# Converting country codes back to country names
convert_name <- function(x) {
      #converts country code to country name
        countrycode(x, origin = "cowc", destination = "country.name")
        }

df_covid$country <- convert_name(df_covid$country)

df_happiness$country <- convert_name(df_happiness$country)

df_life$country <- convert_name(df_life$country)

df_suicide$country <- convert_name(df_suicide$country)

df_sui_happ$country <- convert_name(df_sui_happ$country)

df_wealth$country <- convert_name(df_wealth$country)

df_all$country <-convert_name(df_all$country)

```
#### Data Cleaning
```{r data cleaning, warning = FALSE}

#Remove duplicated countries


df_covid <- df_covid[!duplicated
                 (df_covid[ , "country"
                 ]),]

df_happiness <- df_happiness[!duplicated
                     (df_happiness[ , "country"
                     ]),]

df_life <- df_life[!duplicated
                             (df_life[ , "country"
                             ]),]

df_wealth <- df_wealth[!duplicated
                   (df_wealth[ , "country"
                   ]),]

df_sui_happ <- df_sui_happ[!duplicated
                               (df_sui_happ[ , "country"
                               ]),]

 
df_suicide <- df_suicide %>% distinct(country,sex,
                            .keep_all = TRUE) # Keep duplicated countries according to sex

df_all <- df_all %>% distinct(country,sex,
                            .keep_all = TRUE)

# Delete country missing data

df_covid <- df_covid %>%
  na.omit(country)

df_happiness <- df_happiness %>%
  na.omit(country)

df_life <- df_life %>%
  na.omit(country)

df_suicide <- df_suicide %>%
  na.omit(country)

df_sui_happ <- df_sui_happ %>%
  na.omit(country)

df_wealth <- df_wealth %>%
  na.omit(country)

df_all <- df_all %>%
  na.omit(country)

```

### Preview Of The Data
```{r preview, warning = FALSE}
summary(df_covid)
summary(df_happiness)
summary(df_life)
summary(df_suicide)
summary(df_sui_happ)
summary(df_wealth)
summary(df_all)

```

## Data visualisations
```{r visual, warning = FALSE, results= 'hide'}
# Pre-defined aesthetics
line_alpha = 0.2
point_alpha = 0.8
point_alpha2 = 0.5
individualism_gradient = scale_colour_gradient(low = "blue", 
                                               high = "orange")
gdp_gradient = scale_colour_gradient(low = "#ef8d5d", 
                                     high = "#3fb68e")
gdp_size_scale = scale_size_continuous(range = c(3, 10), 
                 breaks = c(10000, 30000, 50000, 70000))
individualism_xscale = scale_x_continuous(name="Individualism Index", 
                                          breaks= seq(0, 100, 10)) 
theme_type1 = theme_light(base_size = 18) 
              
theme_type2 = theme_light(base_size = 15) 
              
theme_type3 = theme_light(base_size = 12) 
              
adjust_writing = theme(plot.caption = element_text(hjust = 0)) +
                 theme(plot.title = element_text(hjust = 0.5))
overide_line_aes = guide_legend(override.aes =list(linetype =     c(0,0,0,0)))
overide_size_aes = guide_legend(override.aes = list(size = 5))
overide_sizeline_aes = guide_legend(override.aes = list(size = 3,
                                                        linetype = c(0,0,0)))

# Country Wealth Plot
plot_wealth <- ggplot(df_all, aes (x = individualism, 
                                      y = gdp_per_capita, 
                                      shape = ifelse(individualism < 50, "Collectivistic Cultures", "Individualistic Cultures"),
                                      color = individualism)) +
               ggtitle("Countries GDP per Capita and Cultural Orientation") +
               labs(color = "Individualism Index", 
                    shape = "Cultural Orientation") +
               individualism_xscale +
               scale_y_continuous(name="GDP per Capita ($)",
                       breaks= seq(0, 80000, 10000)) +
               geom_smooth((aes(shape=NA)), 
                           method = 'lm', 
                           color = "darkgreen", 
                           alpha = line_alpha) +
               geom_point(size = 4, alpha = point_alpha) +
               individualism_gradient +
               theme_type1 +
               adjust_writing 


# Life Expectancy Plot
plot_life <- ggplot(df_all, aes(x = individualism, 
                                 y = life_expectancy, 
                                 size = gdp_per_capita,
                                 color = gdp_per_capita)) +
            ggtitle("Countries Life Expectancy according to Cultural Orientation and GDP per Capita") +
            labs(color = "GDP per Capita ($)", 
                 size = "GDP per Capita ($)", 
                 caption = "*Life expectancy data is from 2016") +
            individualism_xscale +
            scale_y_continuous(name="Life Expectancy 
(years)", 
                              breaks= seq(0, 100, 2)) +
            gdp_gradient +
            gdp_size_scale +
            geom_smooth(method = 'lm',
                        color = "orange", 
                        alpha = line_alpha) +
            geom_point(alpha = point_alpha) +
            theme_type2 +
            guides(size = overide_line_aes) +
            adjust_writing

# COVID Plot
plot_covid <- ggplot(df_all, aes (x = individualism, 
                                    y = total_cases, 
                                    size = total_deaths,
                                    color = gdp_per_capita)) +
              ggtitle("COVID-19 Cases and Deaths according to Countries Cultural Orientation and Wealth") +
              labs(color = "GDP per Capita ($)", 
                   size = "Total COVID-19 Deaths
(per 1 Million Population)", 
                   caption = "* The 3rd quartile of GDP per Capita equals $42,033
** Data was retrieved on 11/05/2021") +
               individualism_xscale +
               scale_y_continuous(name="Total COVID-19 Cases
(per 1 Million Population)", breaks= seq(0, 155000, 10000)) +
               scale_size_continuous(range = c(3, 13), 
                                     breaks = c(500, 1000, 1500, 2000)) +
               gdp_gradient +
               geom_smooth(method = 'lm', 
                           color = 615, 
                           alpha = line_alpha) +
               geom_point(alpha = point_alpha) +
               theme_type2 +
               guides(size = overide_line_aes) +
               adjust_writing
          
                      
#Happiness plot

plot_happy <- ggplot(df_all, aes(x = individualism,
                                       y = happiness_score,
                                       size = gdp_per_capita, 
                                       color = ifelse(individualism < 50, "Collectivistic Cultures", "Individualistic Cultures"))) + 
              ggtitle(
"Countries Happiness in relation to Cultural Orientation and Wealth") + 
              labs(color = "Cultural Orientation", 
                   size = "GDP per Capita ($)", 
                   caption = "* Happiness scores are produced from indicators in the World Happiness Report 2020") +
                   individualism_xscale + 
                   scale_y_continuous(name="Happiness Score",
                                       breaks= seq(0, 10, 0.5))  +
                   gdp_size_scale +
                   geom_smooth((aes(colour=NA)), 
                               color = "#E7C582", 
                               alpha = line_alpha) +
                   geom_point(alpha = point_alpha) + 
                   theme_type1 +
                   guides(size = overide_line_aes,
                          color = overide_size_aes) +
                   scale_color_manual(values= c("#00B0BA", "#0065A2")) + 
                   adjust_writing


# Suicide Rates 

plot_suicide <- ggplot(df_all, aes(x = individualism, 
                                       y = suicide_rate,
                                       size = gdp_per_capita, 
                                       color = sex, 
                                       shape = sex)) +
                ggtitle("Suicide Rates of the Sexes in regards to Countries Wealth and Cultural Orientation") +
                labs(shape = "Sex", 
                     color = "Sex", 
                     linetype = "Sex", 
                     size = "GDP per Capita ($)", 
                     caption = "* Suicide rates are standardised by age and are from suicides reported in 2016") +
                individualism_xscale + 
                scale_y_continuous(name="Suicide Rate
(per 100000 Population)", 
                                   breaks= seq(0, 50, 5)) +
                gdp_size_scale +
                geom_smooth(method = 'lm', 
                            alpha = line_alpha, 
                            aes(linetype = sex,
                                fill = sex)) +
                geom_point(alpha = point_alpha2) +  
                theme_type2 +
                guides(size = overide_line_aes,   
                shape = overide_sizeline_aes) +
                scale_linetype_manual(values=c("dashed", "solid", "solid")) +
                scale_color_manual(values=c("#5899DA", "#945ECF", "#19A979")) + 
                scale_fill_manual(values=c("#5899DA", "#945ECF", "#19A979")) + 
                guides(fill = FALSE) +
                adjust_writing


#Happiness and suicide rates

plot_sui_happ <- ggplot(df_all, aes(y = suicide_rate, 
                                         x = happiness_score,
                                         size = gdp_per_capita,
                                         color = individualism,
                                         shape = ifelse(individualism < 50, "Collectivistic Cultures", "Individualistic Cultures"))) + 
                ggtitle("Suicide Rates according to Countries Happiness, Wealth and Cultural Orientation") +
                labs(shape = "Cultural Orientation",
                     color = "Individualism Index", 
                     size = "GDP per Capita ($)",
                     caption = "* Suicide rates are standardised by age and reported in 2016
** Happiness scores are produced from indicators in the World Happiness Report 2020") +
                scale_x_continuous(name="Happiness Score",
                                   breaks= seq(0, 10, 0.5)) +
                scale_y_continuous(name="Suicide Rate
(per 100000 Population)",
                                   breaks= seq(0, 50, 5)) +
                gdp_size_scale +
                individualism_gradient +
                geom_point(alpha = point_alpha2) + 
                theme_type3 +
                guides(shape = overide_size_aes) + 
                adjust_writing
                     
                       

shinyApp(
  
ui <- fluidPage(
    titlePanel("Countries Cultural Orientation, Wealth, and Well-Being"),
    
    selectInput("graph", "Choose variables", c("Wealth and Individualism",
                                        "Life Expectancy, Individualism and Wealth",
                                        "COVID-19 Cases and Death, Individualism and Wealth", 
                                        "Happiness, Individualism and Wealth",
                                        "Suicide Rates, Sex, Individualism and Wealth",
                                        "Suicide Rates, Happiness, Individualism and Wealth")),

conditionalPanel('input.graph=="Wealth and Individualism"', plotOutput("wealth")),

conditionalPanel('input.graph=="Life Expectancy, Individualism and Wealth"', plotOutput("life")),

conditionalPanel('input.graph=="COVID-19 Cases and Death, Individualism and Wealth"', plotOutput("covid")),

conditionalPanel('input.graph=="Happiness, Individualism and Wealth"', plotOutput("happy")),

conditionalPanel('input.graph=="Suicide Rates, Sex, Individualism and Wealth"', plotOutput("suicide")),

conditionalPanel('input.graph=="Suicide Rates, Happiness, Individualism and Wealth"', plotOutput("sui_happ"))

),
# Functionality

server <- function(input, output){ 
    
    output$wealth <- renderPlot({
        validate(need(input$graph=="Wealth and Individualism", message=FALSE))
        print(plot_wealth)
    })
    
    output$life <- renderPlot({
        validate(need(input$graph=="Life Expectancy, Individualism and Wealth", message=FALSE))
        print(plot_life)
    })
    
    output$covid <- renderPlot({
        validate(need(input$graph=="COVID-19 Cases and Death, Individualism and Wealth", message=FALSE))
        print(plot_covid)
    }) 
    
     output$happy <- renderPlot({
        validate(need(input$graph=="Happiness, Individualism and Wealth", message=FALSE))
        print(plot_happy)
    }) 
     
     output$suicide <- renderPlot({
        validate(need(input$graph=="Suicide Rates, Sex, Individualism and Wealth", message=FALSE))
        print(plot_suicide)
    }) 
     
      output$sui_happ <- renderPlot({
        validate(need(input$graph=="Suicide Rates, Happiness, Individualism and Wealth", message=FALSE))
        print(plot_sui_happ)
    }) 
  
},

  options = list(height = 600)
)


```

```{r app, warning = FALSE}

knitr::include_app("http://psyassessment.shinyapps.io/psy6422_assignment", 
  height = "600px")
```

## Discussion
### Wealth and Life Expectancy 
### COVID-19 Cases and Deaths
### Happiness
May over fit individualistic countries and ideals and perception of happiness.

Bias as inherently asks about the self rather than the collective. As such, the present reflection may not reflect sense of self and happiness in collectivist cultures but the goals of the group as a whole. 
The best and worse possibilities is also embedded in the context of the country thus having potential avenues in life can influence the score rather than happiness i.e. individualists having restrictive perception of possibilities thus scoring higher, and collectivists perceiving more possibilities through groups thus scoring lower.
Thus is not reflective of subjective happiness, as even if someone is living the pictured best life does not mean that they are happy.

### Suicide Rates and Happiness

## Caveats and Future Directions



